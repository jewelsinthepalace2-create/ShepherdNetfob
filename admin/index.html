<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Panel | ShepherdNet</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    :root { --primary: #4facfe; --glass: rgba(255, 255, 255, 0.05); --border: rgba(255, 255, 255, 0.1); }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { background: #0f172a; color: white; font-family: 'Poppins', sans-serif; display: flex; min-height: 100vh; }
    
    /* Sidebar */
    nav { width: 280px; background: var(--glass); backdrop-filter: blur(15px); border-right: 1px solid var(--border); padding: 40px 20px; display: flex; flex-direction: column; }
    
    /* Profile Header in Sidebar */
    .profile-link { 
        text-decoration: none; 
        padding: 15px; 
        background: rgba(79, 172, 254, 0.1); 
        border-radius: 15px; 
        margin-bottom: 40px; 
        border: 1px solid var(--border);
        transition: 0.3s;
        display: block;
    }
    .profile-link:hover { background: rgba(79, 172, 254, 0.2); transform: translateY(-2px); }
    .profile-link h2 { font-size: 0.65rem; color: var(--primary); margin: 0; letter-spacing: 2px; text-transform: uppercase; }
    .profile-link p { font-size: 0.95rem; color: white; margin: 5px 0 0 0; font-weight: 600; }

    nav a { display: block; color: white; text-decoration: none; padding: 15px 20px; border-radius: 12px; opacity: 0.7; transition: 0.3s; margin-bottom: 5px; font-size: 0.9rem; }
    nav a:hover, nav a.active { opacity: 1; color: var(--primary); background: var(--glass); }

    /* Main Content */
    main { flex: 1; padding: 60px; overflow-y: auto; }
    #welcome-text { font-size: 2.5rem; font-weight: 300; margin-bottom: 5px; }
    #welcome-name { color: var(--primary); font-weight: 600; }
    .subtitle { opacity: 0.5; margin-bottom: 40px; }

    .stat-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; margin-bottom: 40px; }
    .card { background: var(--glass); padding: 30px; border-radius: 24px; border: 1px solid var(--border); backdrop-filter: blur(10px); }
    .card h3 { font-size: 0.8rem; opacity: 0.5; text-transform: uppercase; letter-spacing: 1px; }
    .card p { font-size: 2.5rem; font-weight: bold; margin-top: 10px; color: white; }
    
    .action-card { background: linear-gradient(135deg, rgba(79, 172, 254, 0.1), rgba(0, 0, 0, 0)); border-color: rgba(79, 172, 254, 0.3); }
    .btn-group { display: flex; gap: 15px; margin-top: 20px; }
    button { background: var(--primary); color: #0f172a; border: none; padding: 14px 28px; border-radius: 12px; cursor: pointer; font-weight: 600; transition: 0.3s; }
    button:hover { transform: scale(1.05); box-shadow: 0 5px 15px rgba(79, 172, 254, 0.4); }
  </style>
</head>
<body>
  <nav>
    <a href="../list/settings.html" class="profile-link">
        <h2>Master Admin</h2>
        <p id="nav-name">System Admin</p>
    </a>
    <a href="#" class="active">üåê Global Overview</a>
    <a href="../list/index.html">üìã All Church Members</a>
    <a href="../dashboard/add-user.html">üîë Manage Users</a>
    <div style="flex-grow: 1;"></div>
    <a href="#" id="logoutBtn" style="color: #ff6b6b; opacity: 1;">üö™ Sign Out</a>
  </nav>

  <main>
    <h1 id="welcome-text">Welcome, <span id="welcome-name">Admin</span></h1>
    <p class="subtitle">System-wide analytics and management.</p>

    <div class="stat-grid">
      <div class="card"><h3>Total Pastors</h3><p id="count-pastors">0</p></div>
      <div class="card"><h3>Total Shepherds</h3><p id="count-shepherds">0</p></div>
      <div class="card"><h3>Total Members</h3><p id="count-members">0</p></div>
    </div>
    
    <div class="card action-card">
      <h3>Administrative Controls</h3>
      <div class="btn-group">
        <button onclick="location.href='../dashboard/add-user.html'">Add New Pastor</button>
        <button style="background: rgba(255,255,255,0.1); color: white; border: 1px solid var(--border);">Backup Database</button>
      </div>
    </div>
  </main>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
    import { initializeFirestore, doc, getDoc, collection, getCountFromServer } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";
    
    const firebaseConfig = { apiKey: "AIzaSyCBv60eRCO0e4dFBMKGKnIATouxTuk1Bcc", authDomain: "fob-database-139d1.firebaseapp.com", projectId: "fob-database-139d1", storageBucket: "fob-database-139d1.firebasestorage.app", messagingSenderId: "375165731354", appId: "1:375165731354:web:b5fa57dcb2d71ee0d8c7a3" };
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = initializeFirestore(app, { experimentalForceLongPolling: true }, "fobrealdbase");

    onAuthStateChanged(auth, async (user) => {
      if (user) {
        // Fetch Admin Name
        const adminSnap = await getDoc(doc(db, "master_admin", user.uid));
        if (adminSnap.exists()) {
          const name = adminSnap.data().full_name;
          document.getElementById('welcome-name').innerText = name.split(' ')[0];
          document.getElementById('nav-name').innerText = name;
        }
        getStats();
      } else { window.location.href = "../index.html"; }
    });

    async function getStats() {
      try {
        const [pCol, sCol, mCol] = await Promise.all([
          getCountFromServer(collection(db, "pastors")),
          getCountFromServer(collection(db, "shepherds")),
          getCountFromServer(collection(db, "members"))
        ]);
        
        document.getElementById('count-pastors').innerText = pCol.data().count;
        document.getElementById('count-shepherds').innerText = sCol.data().count;
        document.getElementById('count-members').innerText = mCol.data().count;
      } catch (e) { console.error("Stats Error:", e); }
    }

    document.getElementById('logoutBtn').onclick = (e) => {
        e.preventDefault();
        signOut(auth).then(() => window.location.href="../index.html");
    };
  </script>
</body>
</html>
