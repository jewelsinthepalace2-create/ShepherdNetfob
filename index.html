<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ShepherdNet Login</title>

  <!-- Clerk SDK -->
  <script
    async
    crossorigin="anonymous"
    data-clerk-publishable-key="pk_test_YnJpZWYtc2hhcmstODYuY2xlcmsuYWNjb3VudHMuZGV2JA"
    src="https://js.clerk.dev/v4/clerk.browser.js">
  </script>

  <style>
    body {
      font-family: system-ui, sans-serif;
      background: #f4f6fb;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
    }
    #app {
      width: 100%;
      max-width: 420px;
    }
  </style>
</head>

<body>
  <div id="app"></div>

  <script>
    async function redirectByRole() {
      const token = await Clerk.session.getToken()

      const res = await fetch(
        "https://shepherdnet-api.jewelsinthepalace2.workers.dev/api/me",
        {
          headers: {
            Authorization: `Bearer ${token}`
          }
        }
      )

      if (!res.ok) {
        alert("Authorization failed")
        return
      }

      const user = await res.json()

      switch (user.role) {
        case "master_admin":
          window.location.href = "/admin/index.html"
          break
        case "chapel_leader":
          window.location.href = "/chapel/index.html"
          break
        case "pastor":
          window.location.href = "/pastor/index.html"
          break
        case "shepherd":
          window.location.href = "/shepherd/index.html"
          break
        case "member":
          window.location.href = "/list/index.html"
          break
        default:
          alert("Role not assigned. Contact admin.")
      }
    }

    window.addEventListener("load", async () => {
      await Clerk.load()
      const app = document.getElementById("app")

      if (!Clerk.user) {
        // Not logged in → show Clerk sign in
        Clerk.mountSignIn(app)
        return
      }

      // Logged in → redirect automatically
      redirectByRole()
    })
  </script>
</body>
</html>
